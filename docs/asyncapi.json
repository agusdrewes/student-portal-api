{
  "asyncapi": "3.0.0",
  "info": {
    "title": "Student Portal Events API",
    "version": "1.0.0",
    "description": "AsyncAPI spec for events related to the Student Portal API."
  },
  "channels": {
    "commission.updated": {
      "address": "commission.updated",
      "messages": {
        "CommissionUpdated": {
          "$ref": "#/components/messages/CommissionUpdated"
        }
      }
    },
    "exam.updated": {
      "address": "exam.updated",
      "messages": {
        "ExamUpdated": {
          "$ref": "#/components/messages/ExamUpdated"
        }
      }
    },
    "event.updated": {
      "address": "event.updated",
      "messages": {
        "EventCreated": {
          "$ref": "#/components/messages/EventCreated"
        }
      }
    },
    "purchase.approved": {
      "address": "purchase.approved",
      "messages": {
        "PurchaseApproved": {
          "$ref": "#/components/messages/PurchaseApproved"
        }
      }
    },
    "courses.commission.enrollment.updated": {
      "address": "courses.commission.enrollment.updated",
      "messages": {
        "CommissionEnrollmentUpdated": {
          "$ref": "#/components/messages/CommissionEnrollmentUpdated"
        }
      }
    },
    "library.sanction.updated": {
      "address": "library.sanction.updated",
      "messages": {
        "LibrarySanctionUpdated": {
          "$ref": "#/components/messages/LibrarySanctionUpdated"
        }
      }
    },
    "exam.grade.published": {
      "address": "exam.grade.published",
      "messages": {
        "ExamGradePublished": {
          "$ref": "#/components/messages/ExamGradePublished"
        }
      }
    },
    "gradebook.act.closed": {
      "address": "gradebook.act.closed",
      "messages": {
        "GradebookActClosed": {
          "$ref": "#/components/messages/GradebookActClosed"
        }
      }
    },
    "course.attendance.published": {
      "address": "course.attendance.published",
      "messages": {
        "CourseAttendancePublished": {
          "$ref": "#/components/messages/CourseAttendancePublished"
        }
      }
    }
  },
  "operations": {
    "subscribeCommissionUpdated": {
      "action": "receive",
      "channel": {
        "$ref": "#/channels/commission.updated"
      },
      "summary": "Commission updated",
      "messages": [
        {
          "$ref": "#/channels/commission.updated/messages/CommissionUpdated"
        }
      ]
    },
    "subscribeExamUpdated": {
      "action": "receive",
      "channel": {
        "$ref": "#/channels/exam.updated"
      },
      "summary": "Exam updated",
      "messages": [
        {
          "$ref": "#/channels/exam.updated/messages/ExamUpdated"
        }
      ]
    },
    "subscribeEventCreated": {
      "action": "receive",
      "channel": {
        "$ref": "#/channels/event.updated"
      },
      "summary": "Event updated",
      "messages": [
        {
          "$ref": "#/channels/event.updated/messages/EventCreated"
        }
      ]
    },
    "subscribePurchaseApproved": {
      "action": "receive",
      "channel": {
        "$ref": "#/channels/purchase.approved"
      },
      "summary": "Purchase approved",
      "messages": [
        {
          "$ref": "#/channels/purchase.approved/messages/PurchaseApproved"
        }
      ]
    },
    "subscribeLibrarySanctionUpdated": {
      "action": "receive",
      "channel": {
        "$ref": "#/channels/library.sanction.updated"
      },
      "summary": "Library sanction updated",
      "messages": [
        {
          "$ref": "#/channels/library.sanction.updated/messages/LibrarySanctionUpdated"
        }
      ]
    },
    "subscribeExamGradePublished": {
      "action": "receive",
      "channel": {
        "$ref": "#/channels/exam.grade.published"
      },
      "summary": "Exam grade published",
      "messages": [
        {
          "$ref": "#/channels/exam.grade.published/messages/ExamGradePublished"
        }
      ]
    },
    "subscribeGradebookActClosed": {
      "action": "receive",
      "channel": {
        "$ref": "#/channels/gradebook.act.closed"
      },
      "summary": "Gradebook act closed",
      "messages": [
        {
          "$ref": "#/channels/gradebook.act.closed/messages/GradebookActClosed"
        }
      ]
    },
    "subscribeCourseAttendancePublished": {
      "action": "receive",
      "channel": {
        "$ref": "#/channels/course.attendance.published"
      },
      "summary": "Course attendance published",
      "messages": [
        {
          "$ref": "#/channels/course.attendance.published/messages/CourseAttendancePublished"
        }
      ]
    },
    "publishCommissionEnrollmentUpdated": {
      "action": "send",
      "channel": {
        "$ref": "#/channels/courses.commission.enrollment.updated"
      },
      "summary": "A user enrolled in or withdrew from a commission",
      "messages": [
        {
          "$ref": "#/channels/courses.commission.enrollment.updated/messages/CommissionEnrollmentUpdated"
        }
      ]
    }
  },
  "components": {
    "messages": {
      "CommissionUpdated": {
        "name": "CommissionUpdated",
        "payload": {
          "type": "object",
          "properties": {
            "courseId": { "type": "string" },
            "commissionId": { "type": "string" },
            "days": { "type": "string" },
            "semester": {
              "type": "string",
              "enum": ["1C", "2C"]
            },
            "year": { "type": "string" },
            "startTime": { "type": "string", "format": "time" },
            "endTime": { "type": "string", "format": "time" },
            "shift": {
              "type": "string",
              "enum": ["morning", "afternoon", "night"]
            },
            "professorName": { "type": "string" },
            "availableSpots": { "type": "integer" },
            "totalSpots": { "type": "integer" },
            "mode": { "type": "string", "enum": ["virtual", "in person"] },
            "date": { "type": "string", "format": "date-time" },
            "action": {
              "type": "string",
              "enum": ["update", "delete"],
              "description": "Indicates if the action is an update or delete"
            }
          },
          "required": [
            "courseId",
            "commissionId",
            "days",
            "startTime",
            "endTime",
            "shift",
            "professorName",
            "availableSpots",
            "totalSpots",
            "mode",
            "semester",
            "year",
            "date",
            "action"
          ]
        }
      },
      "ExamUpdated": {
        "name": "ExamUpdated",
        "payload": {
          "type": "object",
          "properties": {
            "examId": { "type": "string" },
            "courseId": { "type": "string" },
            "date": { "type": "string", "format": "date-time" },
            "commissionId": { "type": "string" },
            "action": {
              "type": "string",
              "enum": ["update", "delete"],
              "description": "Indicates if the action is an update or delete"
            }
          },
          "required": ["examId", "courseId", "date", "action"]
        }
      },
      "EventCreated": {
        "name": "EventCreated",
        "payload": {
          "type": "object",
          "properties": {
            "id": { "type": "string" },
            "startDateTime": {
              "type": "string",
              "format": "date-time",
              "example": "2025-09-17T14:30:00Z"
            },
            "endDateTime": {
              "type": "string",
              "format": "date-time",
              "example": "2025-09-17T16:00:00Z"
            },
            "eventType": {
              "type": "string",
              "enum": ["cafeteria", "exam", "extracurricular", "sanci√≥n"]
            },
            "title": { "type": "string" },
            "description": { "type": "string" },
            "user": {
              "type": "object",
              "properties": {
                "id": { "type": "string" },
                "role": {
                  "type": "string",
                  "enum": ["student", "professor"]
                }
              },
              "required": ["id", "role"]
            },
            "date": { "type": "string", "format": "date-time" }
          },
          "required": [
            "id",
            "startDateTime",
            "endDateTime",
            "eventType",
            "title",
            "user",
            "date"
          ]
        }
      },
      "PurchaseApproved": {
        "name": "PurchaseApproved",
        "payload": {
          "type": "object",
          "properties": {
            "id": "string",
            "storeName": { "type": "string" },
            "products": {
              "type": "array",
              "items": {
                "type": "object",
                "properties": {
                  "name": { "type": "string" },
                  "subtotal": { "type": "string" },
                  "quantity": { "type": "integer" },
                  "variantData": {
                    "type": "object",
                    "description": "Dynamic product variant data with any key-value pairs",
                    "additionalProperties": true
                  }
                },
                "required": ["name", "subtotal", "quantity"]
              }
            },
            "total": { "type": "string" },
            "date": { "type": "string", "format": "date-time" }
          },
          "required": ["id", "storeName", "products", "total", "date"]
        }
      },
      "CommissionEnrollmentUpdated": {
        "name": "CommissionEnrollmentUpdated",
        "payload": {
          "type": "object",
          "properties": {
            "userId": { "type": "string" },
            "courseId": { "type": "string" },
            "commissionId": { "type": "string" },
            "date": { "type": "string", "format": "date-time" },
            "action": {
              "type": "string",
              "enum": ["update", "delete"],
              "description": "Indicates if the action is an update or delete"
            }
          },
          "required": ["userId", "courseId", "commissionId", "date", "action"]
        }
      },
      "LibrarySanctionUpdated": {
        "name": "LibrarySanctionUpdated",
        "payload": {
          "type": "object",
          "properties": {
            "userId": { "type": "string" },
            "date": { "type": "string", "format": "date-time" },
            "action": {
              "type": "string",
              "enum": ["update", "delete"],
              "description": "Indicates if the action is an update or delete"
            }
          },
          "required": ["userId", "date", "action"]
        }
      },
      "ExamGradePublished": {
        "name": "ExamGradePublished",
        "payload": {
          "type": "object",
          "properties": {
            "eventId": {
              "type": "string",
              "description": "Unique identifier for the event"
            },
            "occurredAt": {
              "type": "string",
              "format": "date-time",
              "description": "Timestamp of when the event occurred"
            },
            "producer": {
              "type": "string",
              "description": "Source of the event"
            },
            "courseId": {
              "type": "string",
              "description": "Identifier for the course"
            },
            "assessmentId": {
              "type": "string",
              "description": "Identifier for the assessment"
            },
            "studentId": {
              "type": "string",
              "description": "Identifier for the student"
            },
            "grade": { "type": "string", "description": "Grade awarded" },
            "period": {
              "type": "string",
              "description": "Period in which the grade was awarded"
            },
            "action": {
              "type": "string",
              "enum": ["update", "delete"],
              "description": "Indicates if the action is an update or delete"
            }
          },
          "required": [
            "eventId",
            "occurredAt",
            "producer",
            "courseId",
            "assessmentId",
            "studentId",
            "grade",
            "period",
            "action"
          ]
        }
      },
      "GradebookActClosed": {
        "name": "GradebookActClosed",
        "payload": {
          "type": "object",
          "properties": {
            "eventId": {
              "type": "string",
              "description": "Unique identifier for the event"
            },
            "occurredAt": {
              "type": "string",
              "format": "date-time",
              "description": "Timestamp of when the event occurred"
            },
            "producer": {
              "type": "string",
              "description": "Source of the event"
            },
            "actaId": {
              "type": "string",
              "description": "Identifier for the act"
            },
            "cursoId": {
              "type": "string",
              "description": "Identifier for the course"
            },
            "periodo": {
              "type": "string",
              "description": "Period in which the act was closed"
            },
            "items": {
              "type": "array",
              "items": {
                "type": "object",
                "properties": {
                  "studentId": {
                    "type": "string",
                    "description": "Identifier for the student"
                  },
                  "estadoFinal": {
                    "type": "string",
                    "description": "Final status of the student"
                  },
                  "notaMateria": {
                    "type": "string",
                    "description": "Subject grade"
                  }
                },
                "required": ["studentId", "estadoFinal", "notaMateria"]
              }
            },
            "action": {
              "type": "string",
              "enum": ["update", "delete"],
              "description": "Indicates if the action is an update or delete"
            }
          },
          "required": [
            "eventId",
            "occurredAt",
            "producer",
            "actaId",
            "cursoId",
            "periodo",
            "items",
            "action"
          ]
        }
      },
      "CourseAttendancePublished": {
        "name": "CourseAttendancePublished",
        "payload": {
          "type": "object",
          "properties": {
            "eventId": {
              "type": "string",
              "description": "Unique identifier for the event"
            },
            "producer": {
              "type": "string",
              "description": "Source of the event"
            },
            "occurredAt": {
              "type": "string",
              "format": "date-time",
              "description": "Timestamp of when the event occurred"
            },
            "schemaVersion": {
              "type": "string",
              "description": "Schema version"
            },
            "courseId": {
              "type": "string",
              "description": "Identifier for the course"
            },
            "periodo": {
              "type": "string",
              "description": "Period in which the attendance was published"
            },
            "studentId": {
              "type": "string",
              "description": "Identifier for the student"
            },
            "AttendanceTypification": {
              "type": "string",
              "description": "Attendance typification"
            },
            "publishedBy": {
              "type": "string",
              "description": "Identifier of who published the attendance"
            },
            "action": {
              "type": "string",
              "enum": ["update", "delete"],
              "description": "Indicates if the action is an update or delete"
            }
          },
          "required": [
            "eventId",
            "producer",
            "occurredAt",
            "schemaVersion",
            "courseId",
            "periodo",
            "studentId",
            "AttendanceTypification",
            "publishedBy",
            "action"
          ]
        }
      }
    }
  }
}
